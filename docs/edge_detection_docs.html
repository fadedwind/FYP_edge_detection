<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Edge Detection Algorithm Reference</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; line-height: 1.5; }
    h1,h2 { color: #222; }
    pre { background: #f7f7f7; padding: 12px; border-radius: 6px; }
    section { margin-bottom: 28px; }
  </style>
</head>
<body>
  <h1>边缘检测算法详细说明（含数学推导与调参建议）</h1>
  <p>本页面包含常见边缘检测算法（Sobel, Prewitt, Canny, 彩色变体）的数学原理、实现要点、形态学与评估指标（Precision/Recall/F1/ODS/OIS）以及实践调参建议。公式使用 MathJax 渲染。</p>

  <section id="Sobel">
    <h2>Sobel</h2>
    <p>Sobel 算子用于近似图像的一阶导数（梯度）。对平滑后的灰度图 $I_s$：</p>
    <p>$$G_x = I_s * K_x,\quad G_y = I_s * K_y$$</p>
    <p>常用 3x3 Sobel 核：</p>
    <p>$$K_x=\begin{bmatrix}-1&0&1\\-2&0&2\\-1&0&1\end{bmatrix},\quad K_y=K_x^T$$</p>
    <p>梯度幅值：</p>
    <p>$$M=\sqrt{G_x^2+G_y^2}$$</p>
    <p>Sobel 输出通常需要阈值化 $M>t$ 来获得二值边。由于没有 NMS，输出为“厚”边带。</p>
  </section>

  <section id="Prewitt">
    <h2>Prewitt</h2>
    <p>Prewitt 与 Sobel 类似，但卷积核权重不同（中心权重较均匀）：</p>
    <p>$$K_x=\begin{bmatrix}-1&0&1\\-1&0&1\\-1&0&1\end{bmatrix}$$</p>
  </section>

  <section id="Canny">
    <h2>Canny</h2>
    <ol>
      <li>高斯平滑：$$I_s=G_\sigma*I$$</li>
      <li>梯度计算（Sobel）：$G_x,G_y$，幅值 $M=\sqrt{G_x^2+G_y^2}$，方向 $\theta=\arctan2(G_y,G_x)$。</li>
      <li>非极大值抑制（NMS）：沿梯度方向保留局部最大值，将宽边带细化为单像素线。</li>
      <li>双阈值连接（hysteresis）：使用低阈 $t_l$ 和高阈 $t_h$，强边 $M>t_h$；弱边 $t_l<M\le t_h$ 且与强边连通时保留。</li>
    </ol>
    <p>调参建议：通常 Low 与 High 比例取 0.3–0.5（例如 High=220, Low≈100）。提高 High 可以增加 precision，但可能降低 recall。</p>
  </section>

  <section id="ColorVariants">
    <h2>彩色变体</h2>
    <p>对每个颜色通道独立计算边缘响应 $M_R,M_G,M_B$，再合并（如 bitwise_or 或取最大）。可检测颜色边，但会增加噪声。</p>
  </section>

  <section id="Morphology">
    <h2>形态学</h2>
    <p>膨胀与腐蚀用于连通/去噪。开运算用于去除小噪点，闭运算用于填补小缝隙。</p>
  </section>

  <section id="Metrics">
    <h2>评估指标及 ODS/OIS</h2>
    <p>像素级定义：</p>
    <p>$$TP=\sum (D\land R),\quad FP=\sum (D\land\lnot R),\quad FN=\sum(\lnot D \land R)$$</p>
    <p>$$P=\frac{TP}{TP+FP},\quad R=\frac{TP}{TP+FN},\quad F_1=\frac{2PR}{P+R}$$</p>
    <p>ODS：在整个数据集上选择一个全局阈值使平均 F1 最大；OIS：对每图选择最优阈再平均。</p>
  </section>

  <section id="Practical">
    <h2>实践建议（调参策略）</h2>
    <ul>
      <li>若目标是高 precision：使用 Canny，适度增加 Blur，增大 High，减小 Dilate，增大 Area。</li>
      <li>若偏重速度：使用 Sobel，较小 Blur，较少阈值采样。</li>
      <li>用 ODS/OIS 做小规模网格搜索选择折中参数。</li>
    </ul>
  </section>

</body>
</html>
